# ==============================
# PowerShell Profile Configuration
# File: $PROFILE
# ==============================

# --- Safety: Prevent errors from stopping profile load ---
$ErrorActionPreference = 'Continue'
#
# --- Load Modules ---
#if (Get-Module -ListAvailable -Name *) {
#    Import-Module posh-git
#}
#
# Change folder
#Set-Location C:\Windows\system32
#
# Display welcome message
#"Welcome: " + $env:Username
Write-Host "Welcome: $env:Username"
#
# unlimited History and Enumeration results
$FormatEnumerationLimit = -1
#
#
#
# Increase the number of PowerShell Commands stored in the log
Set-PSReadlineOption -MaximumHistoryCount 10000
Set-PSReadlineOption -HistoryNoDuplicates
Set-PSReadLineOption -HistorySaveStyle SaveIncrementally
Set-PSReadLineKeyHandler -Key Tab -Function MenuComplete
Set-PSReadLineOption -PredictionSource HistoryAndPlugin
#Set-PSReadlineOption 
#
#(Get-PSReadLineOption).HistoryNoDuplicates = $false
#(Get-PSReadLineOption).MaximumHistoryCount = 10000
#(Get-PSReadLineOption).AddToHistoryHandler = MemoryAndFile
#(Get-PSReadLineOption).
#
#'obsolet, use the Script with $historyPath inside'
#"$Env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\$($Host.Name)_history.txt" 
#Set-PSReadLineOption -HistorySavePath "$Env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\$($Host.Name)_history.txt"
#
$historyPath = "$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt"

if (Test-Path $historyPath) {
    $lines = Get-Content $historyPath -Tail 50

    # Filter: Just real PowerShell Commands
    $clean = foreach ($line in $lines) {
        if ([string]::IsNullOrWhiteSpace($line)) { continue }
        if ($line.StartsWith("#")) { continue }
        if ($line[0] -eq 0x1B) { continue }
        $line
    }

    Write-Host "`nLast 50 Commands:" -ForegroundColor Cyan
    $clean | ForEach-Object { Write-Host $_ }
}
#
#
# AusführungsPolicy 
# 'Bypass'=noCertificate-Check, RemoteSigned= blocks digital-unsigned Scripts, 
# AllSigned=Just certificated Files and Scripts,
# unrestricted=uneingeschränkt_visit 'Bypass'-Description, undefined=not defined
Set-ExecutionPolicy -ExecutionPolicy 'Bypass' -Scope 'CurrentUser'
#
# Let's add a simple function that displays the last 10 commands from the PowerShell console history
#function h10 { Get-History -Count 50 }
function h10 { Get-Content (Get-PSReadLineOption).HistorySavePath -Tail 50 }
#
#Powershell auto Module-Import on use the specify Command from this Module 
$PSModuleAutoloadingPreference = "All"
#
# Auto-load frequently used modules
#$modulesToLoad = @(
#    	"Az.Accounts",
#    	"Pester",
#	"WindowsUpdate",
#	"PSReadLine",
#	"PowerShellGet",
#	"PackageManagement",
#	"Microsoft.PowerShell.Operation.Validation",
#	"Microsoft.WindowsAdminCenter.CredSspPolicy",
#	"WindowsSearch",
#	"WindowsErrorReporting",
#	"WindowsDeveloperLicense",
#	"VpnClient",
#	"TroubleshootingPack",
#	"TLS",
#	"StorageBusCache",
#	"Storage",
#	"StartLayout",
#	"SecureBoot",
#	"ScheduledTasks",
#	"PSScheduledJob",
#	"ScheduledTasks",
#	"PSDiagnostics",
#	"PSDesiredStateConfiguration",
#	"Provisioning",
#	"ProcessMitigations",
#	"PrintManagement",
#	"PKI",
#	"PersistentMemory",
#	"OsConfiguration",
#	"NetworkTransition",
#	"NetworkSwitchManager",
#	"NetworkConnectivityStatus",
#	"NetTCPIP",
#	"NetSwitchTeam",
#	"NetSecurity",
#	"NetQos",
#	"NetNat",
#	"NetLbfo",
#	"NetEventPacketCapture",
#	"NetConnection",
#	"NetAdapter",
#	"MSMQ",
#	"MsDtc",
#	"MMAgent",
#	"Microsoft.WSMan.Management",
#	"Microsoft.Windows.Bcd.Cmdlets",
#	"Microsoft.ReFsDedup.Commands",
#	"Microsoft.PowerShell.Utility",
#	"Microsoft.PowerShell.Security",
#	"Microsoft.PowerShell.ODataUtils",
#	"Microsoft.PowerShell.Management",
#	"Microsoft.PowerShell.LocalAccounts",
#	"Microsoft.PowerShell.Host",
#	"Microsoft.PowerShell.Diagnostics",
#	"Microsoft.PowerShell.Archive",
#	"Kds",
#	"ISE",
#	"iSCSI",
#	"International",
#	"HostNetworkingService",
#	"IISAdministration",
#	"GroupPolicy",
#	"Get-NetView",
#	"EventTracingManagement",
#	"DnsClient",
#	"Dism",
#	"ConfigDefender",
#	"ConfigCI",
#	"CimCmdlets",
#	"Appx",
#	"AppBackgroundTask",
#	"AppvClient",
#	"WinGet",
#	"NuGet",
#	"LAPS"
#)
#
#foreach ($module in $modulesToLoad) {
#    try {
#        Import-Module $module -ErrorAction SilentlyContinue
#        Write-Host "Modul geladen: $module" -ForegroundColor Green
#    }
#    catch {
#        Write-Warning "Folgendes Modul konnte nicht geladen werden: $module"
#    }
#}

#f45873b3-b655-43a6-b217-97c00aa0db58 PowerToys CommandNotFound module

Import-Module -Name Microsoft.WinGet.CommandNotFound
#f45873b3-b655-43a6-b217-97c00aa0db58
